# IQRF Gateway for Docker
# Running on RPI1

version: '3'

services:
  daemon:
    depends_on:
      - mosquitto
    image: iqrftech/iqrf-gateway-daemon:latest-armel
    privileged: true
    volumes:
      - config-data:/etc/iqrf-gateway-daemon
    hostname: iqrf-gateway-daemon
    networks:
      - iqrf-network
    links:
      - mosquitto  
    ports:
      - "1338:1338"
      - "55000:55000/udp" 
      - "55300:55300/udp"
    expose:
      - "1338"
    devices:
      - "/dev/spidev0.0:/dev/spidev0.0"
    restart: always

  webapp:
    depends_on:
      - daemon
    image: iqrftech/iqrf-gateway-webapp:latest-arm32v6
    volumes:
      - config-data:/etc/iqrf-gateway-daemon
    hostname: iqrf-gateway-webapp
    networks:
      iqrf-network:
        aliases:
            - iqrf-gateway-webapp
    links:
      - daemon
    ports:
      - "8080:8080"
    environment:
      - IQRFGD_WS_SERVER=ws://daemon:1338
    restart: always

  mosquitto:
    image: eclipse-mosquitto
    networks:
      iqrf-network:
        aliases:
            - mosquitto
    expose:
      - "1883"
    ports:
      - "1883:1883"
    restart: always

volumes:
  config-data:

networks:
  iqrf-network:
    driver: "bridge"
